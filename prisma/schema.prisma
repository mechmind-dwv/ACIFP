// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model Medicamento {
  id                String   @id @default(cuid())
  nombreGenerico     String   @unique
  codigoAtc          String?  // C贸digo de Clasificaci贸n Qu铆mica, Terap茅utica y Anat贸mica
  grupoTerapeutico   String?  // Categor铆a principal (Ej: Anticoagulante, Analg茅sico)
  rutaMetabolica     String?  // Enzima CYP principal involucrada
  nombreComercial    String?
  descripcion        String?
  viaAdministracion  String?
  dosisRecomendada   String?
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
  
  // Relaciones
  interaccionesComoPrincipal InteraccionMaestra[] @relation("MedicamentoPrincipal")
  interaccionesComoSecundario InteraccionMaestra[] @relation("MedicamentoSecundario")
}

model InteraccionMaestra {
  id                    String   @id @default(cuid())
  medicamentoPrincipalId  String
  medicamentoSecundarioId String
  gravedad              GravedadClinica // 'ALTA_MAYOR', 'MODERADA', 'BAJA_MENOR'
  mecanismoAccion       String   // Explicaci贸n de c贸mo interact煤an
  accionResultante      String   // El efecto farmacol贸gico directo
  consecuenciaPotencial  String   // Consecuencia cl铆nica espec铆fica
  referenciaFuente      String?  // Fuente de la informaci贸n (Ej: FDA, DrugBank ID)
  nivelEvidencia        NivelEvidencia? // Nivel de evidencia cient铆fica
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt
  
  // Relaciones
  medicamentoPrincipal   Medicamento @relation("MedicamentoPrincipal", fields: [medicamentoPrincipalId], references: [id], onDelete: Cascade)
  medicamentoSecundario  Medicamento @relation("MedicamentoSecundario", fields: [medicamentoSecundarioId], references: [id], onDelete: Cascade)
  
  // Relaciones 1:N
  patologiasCorrelacionadas PatologiaCorrelacionada[]
  recomendaciones          Recomendacion[]
  
  @@unique([medicamentoPrincipalId, medicamentoSecundarioId])
}

model PatologiaCorrelacionada {
  id                    String   @id @default(cuid())
  interaccionId          String
  nombrePatologia        String   // Nombre de la condici贸n o enfermedad
  manifestacionClinica   String?  // S铆ntomas o hallazgos clave
  incidenciaEstimada     String?  // Frecuencia de aparici贸n (Ej: Raro, Com煤n)
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt
  
  // Relaci贸n
  interaccion            InteraccionMaestra @relation(fields: [interaccionId], references: [id], onDelete: Cascade)
}

model Recomendacion {
  id                    String   @id @default(cuid())
  interaccionId          String
  tipoManejo            TipoManejoClinico // 'EVITAR_ABSOLUTAMENTE', 'AJUSTE_DOSIS', 'MONITORIZACION_CERCANA', 'ESPACIAR_ADMINISTRACION'
  prioridad             PrioridadRecomendacion // 'URGENTE', 'IMPORTANTE', 'INFORMATIVO'
  detalleRecomendacion  String   // Instrucci贸n prescriptiva clara
  responsable           ResponsableAccion // 'MEDICO', 'FARMACEUTICO', 'PACIENTE', 'SISTEMA_SALUD'
  tiempoAccion          String?  // Ej: "Inmediato", "24-48 horas", "Semanal"
  parametrosMonitoreo   String?  // Par谩metros espec铆ficos a monitorear
  accionAlternativa     String?  // Alternativas terap茅uticas
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt
  
  // Relaci贸n
  interaccion            InteraccionMaestra @relation(fields: [interaccionId], references: [id], onDelete: Cascade)
}

model PatologiaPreexistente {
  id          String   @id @default(cuid())
  nombre      String   @unique
  descripcion String?
  categoria   String?  // "Cardiovascular", "Renal", "Hep谩tico", etc.
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

enum GravedadClinica {
  ALTA_MAYOR    //  Riesgo potencialmente mortal, da帽o irreversible
  MODERADA      //  Deterioro significativo pero reversible
  BAJA_MENOR    //  Efectos m铆nimos, manejables
}

enum TipoManejoClinico {
  EVITAR_ABSOLUTAMENTE     // Evitar completamente la combinaci贸n
  AJUSTE_DOSIS             // Modificar dosis de uno o ambos f谩rmacos
  MONITORIZACION_CERCANA    // Vigilancia estrecha de par谩metros
  ESPACIAR_ADMINISTRACION    // Separar horarios de administraci贸n
  EDUCAR_PACIENTE         // Informar al paciente sobre s铆ntomas
  CONSULTAR_ESPECIALISTA    // Derivar a especialista
}

enum PrioridadRecomendacion {
  URGENTE        // Requiere acci贸n inmediata
  IMPORTANTE     // Requiere acci贸n pronto
  INFORMATIVO    // Informaci贸n para conocimiento
}

enum ResponsableAccion {
  MEDICO           // Responsabilidad del m茅dico tratante
  FARMACEUTICO     // Responsabilidad del farmac茅utico
  PACIENTE         // Responsabilidad del paciente
  SISTEMA_SALUD    // Responsabilidad del sistema de salud
}

enum NivelEvidencia {
  ENSAYO_CLINICO        // Ensayos controlados aleatorizados
  ESTUDIO_COHORTE        // Estudios de cohorte, casos y controles
  REPORTE_CASOS         // Reportes de casos, series de casos
  OPINION_EXPERTOS       // Consensos, gu铆as cl铆nicas
}